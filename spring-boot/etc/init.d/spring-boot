#!/usr/bin/env ksh

### BEGIN INIT INFO
# Provides:              spring-boot
# Required-Start:        $all
# Required-Stop:         $all
# Default-Start:         2 3 4 5
# Default-Stop:          0 1 6
# Short-Description:     starts the spring-boot applications
# Description:           starts spring-boot using start-stop-daemon
### END INIT INFO

set_config() {
    name="${1}"
    attr="${2}"
    value="${3}"
    [[ -z ${name} || -z ${attr} ]] || return 1

    config="/etc/spring-boot/conf.d/${name}.json"
    json=`jq . ${config} 2>/dev/null`
    if [[ -z ${json} ]]; then
	echo "${json}" | jq -r '.${attr}="${value}"' 2>/dev/null > ${config}
    else
	return 1
    fi
    return 0
}
    
list() {
   echo -e ""
   echo -e "ID\t\tName\t\tVersion\t\tDescription"
   echo -e "--\t\t----\t\t-------\t\t-----------"
   for x in /etc/spring-boot/conf.d/*; do
      jq -r '[.id, .name, .version, .desc] | join("\t\t")' ${x} 2>/dev/null
   done
}

case "$1" in
#    start)
#        echo "Starting $DESC"
#        start
#        ;;
#    stop)
#        echo "Stopping $APP_DESC"
#        stop
#        ;;
#    restart)
#        echo "Restarting $APP_DESC"
#        stop
#        sleep 1
#        start
#        ;;
    list)
       list
        ;;
    *)
        N=/etc/init.d/$NAME
        echo "Usage: $N {start|stop|restart|list} [app]" >&2
        exit 1
        ;;
esac
exit 0
